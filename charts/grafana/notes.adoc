= Notes for Grafana deployment
Álvaro López Medina <alopezme@redhat.com>
v1.0, 2022-04
// Create TOC wherever needed
:toc: macro
:sectanchors:
:sectnumlevels: 2
:sectnums: 
:source-highlighter: pygments
:imagesdir: images
// Start: Enable admonition icons
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]
ifndef::env-github[]
:icons: font
endif::[]
// End: Enable admonition icons


// Create the Table of contents here
toc::[]

To deploy the community-powered Grafana operator on OCP 4.9 just follow these steps.


== Deploy Operator

[source, bash]
----
oc process -f grafana-01-operator.yaml -p OPERATOR_NAMESPACE="grafana" | oc apply -f -
----

== Deploy Grafana

[source, bash]
----
oc process -f grafana-02-instance.yaml | oc apply -f -
----

== Deploy Data source

[source, bash]
----
oc process -f grafana-03-datasource.yaml | oc apply -f -
----

// [source, yaml]
// ----
// Ejemplo orion-datasource

//   - name: orion-datasource
//     type: orion-datasource
//     access: proxy
//     orgId: 1
//     uid: 2
//     url: http://orion:1026/
//     basicAuth: false
//     withCredentials: false
//     isDefault: false
//     jsonData:
//       access_via_token: false
//       orionPaginationLimit: 500
//       url: http://orion:1026/
//     secureJsonFields:
//     version: 1
//     editable: true
// ----

// [source, yaml]
// ----
// Ejemplo orion-datasource
//   - name: postgres-datasource
//     type: postgres
//     access: proxy
//     orgId: 1
//     uid: 3
//     url: {{ timescale_url }}:5432
//     user: {{ timescale_readonly_user }}
//     password: {{ timescale_readonly_password }}
//     database:
//     basicAuth: false
//     withCredentials: false
//     isDefault: false
//     jsonData:
//       sslmode: disable
//       postgresVersion: 903
//     version: 1
//     editable: true
// ----

// [source, yaml]
// ----
// - GF_INSTALL_PLUGINS=https://hopu.eu/wp-content/grafana/orion-datasource-0.4.6.zip;orion-datasource
// ----

// [source, json]
// ----

// ----


== Deploy Dashboard

Now, we will create a Grafana dashboard:
[source, bash]
----
DASHBOARD_NAME="dashboard-opendata"
# Create a configMap containing the Dashboard
oc create configmap $DASHBOARD_NAME --from-file=dashboard=$DASHBOARD_NAME.json -n grafana
# Create a Dashboard object that automatically updates Grafana
oc process -f grafana-04-dashboard.yaml -p DASHBOARD_NAME=$DASHBOARD_NAME | oc apply -f -
----